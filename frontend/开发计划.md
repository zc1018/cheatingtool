# macOS AI 实时语音助手 - 前端开发计划

## 项目概述

为 macOS AI 实时语音助手开发现代化、用户友好的桌面前端界面，实时展示转写内容、AI 分析和建议回复。

## 技术栈建议

### 方案一：Electron + React（推荐）
- **框架**: Electron 28+ / React 18+
- **状态管理**: Zustand / Jotai
- **UI 库**: shadcn/ui / Ant Design
- **样式**: TailwindCSS
- **实时通信**: Native WebSocket
- **音频可视化**: Wavesurfer.js / Web Audio API

**优点**:
- 跨平台桌面应用
- 原生 macOS 集成（菜单栏、通知）
- 可打包为 .app 文件
- 丰富的生态系统

### 方案二：Tauri + React/Svelte
- **框架**: Tauri 2.0 / React 18+ / Svelte 5
- **UI 库**: shadcn-ui / Skeleton UI
- **样式**: TailwindCSS
- **优点**: 更小的体积，更好的性能，更安全

### 方案三：Web 应用（浏览器）
- **框架**: Next.js 14 / React 18+
- **UI 库**: shadcn/ui
- **PWA**: 支持离线使用
- **优点**: 快速开发，跨平台访问

## 目录结构

```
frontend/
├── src/
│   ├── components/           # React 组件
│   │   ├── layout/          # 布局组件
│   │   │   ├── Header.tsx
│   │   │   ├── Sidebar.tsx
│   │   │   └── MainLayout.tsx
│   │   ├── audio/           # 音频相关
│   │   │   ├── AudioVisualizer.tsx
│   │   │   └── AudioControls.tsx
│   │   ├── transcription/   # 转写显示
│   │   │   ├── TranscriptionList.tsx
│   │   │   ├── TranscriptionItem.tsx
│   │   │   └── SpeakerLabel.tsx
│   │   ├── analysis/        # 分析显示
│   │   │   ├── AnalysisCard.tsx
│   │   │   ├── IntentDisplay.tsx
│   │   │   ├── ThoughtsDisplay.tsx
│   │   │   └── SuggestionCard.tsx
│   │   ├── config/          # 配置界面
│   │   │   ├── ConfigPanel.tsx
│   │   │   ├── LLMConfig.tsx
│   │   │   ├── STTConfig.tsx
│   │   │   └── ScenarioEditor.tsx
│   │   └── prompts/         # Prompt 管理
│   │       ├── PromptList.tsx
│   │       ├── PromptEditor.tsx
│   │       └── PromptCard.tsx
│   ├── pages/               # 页面
│   │   ├── Home.tsx
│   │   ├── Settings.tsx
│   │   └── Prompts.tsx
│   ├── hooks/               # 自定义 Hooks
│   │   ├── useWebSocket.ts
│   │   ├── useTranscription.ts
│   │   ├── useAnalysis.ts
│   │   └── useConfig.ts
│   ├── store/               # 状态管理
│   │   ├── useAppStore.ts
│   │   ├── useAudioStore.ts
│   │   ├── useTranscriptionStore.ts
│   │   └── useConfigStore.ts
│   ├── services/            # API 服务
│   │   ├── api.ts           # REST API 客户端
│   │   ├── websocket.ts     # WebSocket 客户端
│   │   └── types.ts         # TypeScript 类型定义
│   ├── utils/               # 工具函数
│   │   ├── formatters.ts
│   │   └── validators.ts
│   ├── styles/              # 样式
│   │   └── globals.css
│   ├── App.tsx
│   └── main.tsx
├── public/
│   └── assets/
├── package.json
├── tsconfig.json
├── vite.config.ts           # Vite 配置
└── tailwind.config.js       # Tailwind 配置
```

## 核心功能模块

### 1. 实时转写显示
- **功能**: 实时显示语音转写结果
- **组件**: `TranscriptionList`, `TranscriptionItem`, `SpeakerLabel`
- **特性**:
  - 区分用户/对方发言（不同颜色）
  - 流式更新（final=false 时显示为临时状态）
  - 时间戳显示
  - 自动滚动到最新消息
  - 复制文本功能

### 2. AI 分析展示
- **功能**: 显示 AI 分析结果和建议回复
- **组件**: `AnalysisCard`, `IntentDisplay`, `ThoughtsDisplay`, `SuggestionCard`
- **特性**:
  - 意图分析（高亮关键词）
  - 思考过程展示（可展开/折叠）
  - 真实需求提取
  - 建议回复卡片（一键复制）
  - 置信度指示器

### 3. 音频可视化
- **功能**: 实时音频波形显示
- **组件**: `AudioVisualizer`, `AudioControls`
- **特性**:
  - 实时波形图
  - 音量指示器
  - 频谱分析（可选）
  - 开始/停止控制按钮
  - 状态指示灯

### 4. 配置管理界面
- **功能**: 管理应用配置
- **组件**: `ConfigPanel`, `LLMConfig`, `STTConfig`, `ScenarioEditor`
- **特性**:
  - LLM 提供商选择（OpenAI, Anthropic, Ollama）
  - 模型选择下拉框
  - API Key 输入（密码遮罩）
  - 温度滑块
  - 场景配置编辑器
  - 实时保存
  - 配置导入/导出

### 5. Prompt 模板管理
- **功能**: 管理分析提示词模板
- **组件**: `PromptList`, `PromptEditor`, `PromptCard`
- **特性**:
  - 模板列表（卡片式）
  - 分类筛选
  - 创建/编辑/删除
  - Markdown 编辑器
  - 预览功能
  - 一键应用

### 6. 状态监控
- **功能**: 显示服务运行状态
- **组件**: `StatusIndicator`, `HealthCheck`
- **特性**:
  - 连接状态指示
  - 服务健康度
  - 错误提示
  - WebSocket 连接数

## UI/UX 设计建议

### 设计风格
- **主题**: 现代简约，类似 macOS 原生应用
- **配色**:
  - 主色: #007AFF（macOS 蓝）
  - 用户发言: #34C759（绿色）
  - 对方发言: #FF3B30（红色）
  - 背景: #F5F5F7（浅灰）
  - 卡片: #FFFFFF（白色）
- **字体**: SF Pro / Inter
- **圆角**: 12px
- **阴影**: 柔和的阴影效果

### 布局方案
```
┌─────────────────────────────────────────────────────────┐
│ Header: Logo | 状态指示器 | 配置按钮                    │
├──────────────┬──────────────────────────────────────────┤
│              │                                          │
│   Sidebar    │         Main Content Area               │
│              │                                          │
│ - 首页       │  ┌─────────────────────────────────┐   │
│ - 配置       │  │   Audio Visualizer              │   │
│ - Prompts    │  │   [Start] [Stop]               │   │
│              │  └─────────────────────────────────┘   │
│              │                                          │
│              │  ┌─────────────────────────────────┐   │
│              │  │   Transcription List            │   │
│              │  │   - [User] 你好...              │   │
│              │  │   - [Other] 请问...             │   │
│              │  └─────────────────────────────────┘   │
│              │                                          │
│              │  ┌─────────────────────────────────┐   │
│              │  │   AI Analysis                   │   │
│              │  │   Intent: ...                  │   │
│              │  │   Suggestion: ...               │   │
│              │  └─────────────────────────────────┘   │
└──────────────┴──────────────────────────────────────────┘
```

## 技术实现要点

### WebSocket 集成
```typescript
// hooks/useWebSocket.ts
import { useEffect, useRef } from 'react';
import { useAppStore } from '@/store/useAppStore';

export function useWebSocket(url: string) {
  const wsRef = useRef<WebSocket | null>(null);
  const addMessage = useAppStore((state) => state.addMessage);

  useEffect(() => {
    wsRef.current = new WebSocket(url);

    wsRef.current.onopen = () => {
      console.log('WebSocket connected');
    };

    wsRef.current.onmessage = (event) => {
      const message = JSON.parse(event.data);

      switch (message.type) {
        case 'transcription':
          addMessage({
            type: 'transcription',
            data: message,
          });
          break;
        case 'analysis':
          addMessage({
            type: 'analysis',
            data: message,
          });
          break;
      }
    };

    return () => {
      wsRef.current?.close();
    };
  }, [url]);
}
```

### REST API 客户端
```typescript
// services/api.ts
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:8000',
  timeout: 10000,
});

export const audioAPI = {
  start: () => api.post('/api/audio/start'),
  stop: () => api.post('/api/audio/stop'),
  getStatus: () => api.get('/api/audio/status'),
};

export const configAPI = {
  get: () => api.get('/api/config/'),
  update: (config: any) => api.put('/api/config/', config),
};
```

### 状态管理（Zustand）
```typescript
// store/useAppStore.ts
import { create } from 'zustand';

interface AppStore {
  isCapturing: boolean;
  messages: Message[];
  analysis: Analysis | null;
  setCapturing: (capturing: boolean) => void;
  addMessage: (message: Message) => void;
  setAnalysis: (analysis: Analysis) => void;
}

export const useAppStore = create<AppStore>((set) => ({
  isCapturing: false,
  messages: [],
  analysis: null,
  setCapturing: (capturing) => set({ isCapturing: capturing }),
  addMessage: (message) => set((state) => ({
    messages: [...state.messages, message],
  })),
  setAnalysis: (analysis) => set({ analysis }),
}));
```

## 实施步骤

### 阶段 1: 项目初始化（1-2 天）
1. 创建项目（Vite + React + TypeScript）
2. 安装依赖（TailwindCSS, shadcn/ui, Zustand）
3. 配置开发环境
4. 设置项目结构

### 阶段 2: 基础 UI 组件（2-3 天）
1. 实现布局组件（Header, Sidebar, MainLayout）
2. 创建基础 UI 组件库（Button, Card, Input 等）
3. 配置主题和样式

### 阶段 3: 核心功能（4-5 天）
1. **WebSocket 集成**: 实现实时通信
2. **转写显示**: 实现转写列表和消息组件
3. **分析展示**: 实现 AI 分析卡片
4. **音频控制**: 实现控制按钮和状态显示
5. **音频可视化**: 实现波形显示

### 阶段 4: 配置和管理（2-3 天）
1. **配置界面**: LLM/STT 配置表单
2. **Prompt 管理**: Prompt 列表和编辑器
3. **状态监控**: 服务状态显示

### 阶段 5: 打包和部署（1-2 天）
1. **Electron 打包**: 配置打包脚本
2. **图标和资源**: 准备应用图标
3. **测试**: 功能测试和性能优化
4. **发布**: 生成 .dmg / .app 文件

## 依赖清单

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "zustand": "^4.4.0",
    "axios": "^1.6.0",
    "wavesurfer.js": "^7.4.0",
    "lucide-react": "^0.300.0",
    "clsx": "^2.0.0",
    "tailwind-merge": "^2.0.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@vitejs/plugin-react": "^4.2.0",
    "autoprefixer": "^10.4.0",
    "postcss": "^8.4.0",
    "tailwindcss": "^3.4.0",
    "typescript": "^5.3.0",
    "vite": "^5.0.0",
    "electron": "^28.0.0",
    "electron-builder": "^24.9.0"
  }
}
```

## API 集成说明

详见 `backend/API.md`，主要端点：

### REST API
- `GET /api/audio/status` - 获取音频状态
- `POST /api/audio/start` - 开始捕获
- `POST /api/audio/stop` - 停止捕获
- `GET /api/config/` - 获取配置
- `PUT /api/config/` - 更新配置
- `GET /api/prompts/` - 获取 Prompt 列表
- `POST /api/prompts/` - 创建 Prompt
- `GET /health` - 健康检查

### WebSocket
- `ws://localhost:8000/ws/stream` - 实时流

## 数据流

```
┌─────────────────┐    WebSocket     ┌──────────────┐
│   Frontend      │◄────────────────►│   Backend    │
│  (React/Electron│   (转写、分析)    │  (FastAPI)   │
└─────────────────┘                  └──────────────┘
        │                                   │
        │ REST API                          │
        └───────────────────────────────────┘
     (配置、控制)
```

## 测试计划

- [ ] 单元测试（Vitest）
- [ ] 组件测试（React Testing Library）
- [ ] E2E 测试（Playwright）
- [ ] 手动测试（所有功能）
- [ ] 性能测试（长时间运行）

## 参考资源

- [Electron 文档](https://www.electronjs.org/docs)
- [shadcn/ui](https://ui.shadcn.com/)
- [Vite 文档](https://vitejs.dev/)
- [Zustand 文档](https://zustand-demo.pmnd.rs/)
- [Wavesurfer.js](https://wavesurfer-js.org/)

---

**最后更新**: 2026-01-28
**预计开发时间**: 10-15 天
**负责人**: Gemini 3 (Antigravity)
